# Ahnlab_TrusGuard_Blacklist_Helper

## About
A project developed in order to help managing tasks about harmful IP and URL blacklists in Ahnlab TrusGuard UTM device.

Ahnlab에서 개발한 UTM 장비인 TrusGuard의 유해 IP 및 URL 차단 blacklist 기능을 더 쉽게 사용하기 위한 보조 프로그램 입니다.

----

## Requirements

- Python 3 설치가 필요합니다.
- csv 파일을 수정할 수 있는 텍스트 편집기 및 스프레드시트 프로그램(Excel, 한셀 등)이 필요합니다.

## 2022.10. 추가

- 현재 repo는 군 복무 시절 직접 개발하여 사용하였던 Ahnlab 사의 UTM 운용에 적합한 보조 프로그램의 소스 코드를 공유하려 생성하였지만, 군 내부망에서 데이터를 가져오는 과정에 여러 문제가 있는 관계로 잠정 중단되었습니다.
- 실제 소스 코드를 첨부할 수는 없지만, 프로그램 생성 배경과 대략적인 기능을 아래에 소개합니다. 비슷한 상황에 닥친 군 장병 및 UTM 관리 담당자들이 영감을 받아 문제를 해결하는데 도움이 되었으면 좋겠습니다.

### 개발 배경
- Ahnlab TrusGuard UTM에는 유해하다고 알려진 IP, 네트워크 대역 및 URL을 블랙리스트에 등록하여 해당 IP를 발,수신지로 하는 패킷을 막는 기능이 있습니다.
- 각각의 장비의 사양에 따라 최대로 등록할 수 있는 IP 객체의 수가 다른데, 최대 등록 제한을 초과하여 새로운 IP를 등록할 수는 없습니다.
- 이 경우 기 등록된 IP 중 위협을 끼치지 않는다고 여겨지는 것들을 우선적으로 제거한 뒤 새롭게 위협적이라고 판단된 IP를 등록하는 작업이 필요했습니다.
- 문제는 유해 IP를 등록하는 방법이 UTM 장비 관리용 웹 페이지의 텍스트 입력창에 csv 형식의 텍스트로 입력을 한 뒤 적용하는 방식이었기 때문에, 기 차단된 IP 목록을 수정하거나 새로운 IP를 추가하는 작업이 매우 번거로웠습니다.

### 문제 해결 방안
- 기 차단된 IP 목록은 관리용 웹 페이지에 텍스트 형식으로 저장되어 있는데, 이와 동일한 내용을 담은 데이터베이스를 구축하여 SQL 등을 통해 더 효율적으로 관리할 수 있도록 했습니다.
- 일정 주기로 차단 해제 대상 IP와 새롭게 차단해야 하는 IP를 전달받은 경우, 해제 대상 IP는 기존 차단 목록 DB에서 검색하여 해제하고, 새롭게 차단해야 하는 IP는 기 차단 목록에 없는 새로운 IP들만 차단 목록 DB에 추가했습니다.
- 이후 UTM 장비에 IP를 등록할 때는 DB에 저장된 정보를 UTM 관리 페이지에 적합한 입력 형식으로 자동으로 변환하여 텍스트 편집기를 통해 복사한 뒤 입력했습니다... 자세한 사정은 밝히기 어렵지만 놀랍게도 이 방안이 최선이었습니다.

### 구현 방법
- 군 내부망에서도 활용 가능한 Python(Anaconda)를 기반으로 하여 기본으로 설치되어 있는 SQLite DB를 이용해 유해 IP를 저장 및 관리했습니다.
- 기 차단된 IP 목록은 csv 형식의 텍스트였기 때문에, 입력과 출력을 해당 형식에 맞게 조정할 수 있도록 했습니다.
- 2019년에 들었던 정형수 교수님의 DB 수업에서 배운 내용에서 영감을 받아, 해제 대상 IP와 기 차단 IP를 비교하는 과정에서 Sort-Merge Join 알고리즘을 응용했습니다. 기 차단 IP 목록을 항상 정렬된 상태로 유지하면, N개의 차단 IP 목록이 있을 때 N번의 탐색만으로 차단 해제 IP가 존재하는지 모두 찾을 수 있습니다.
- 진행이 오래 걸려서 진행 상황을 시각적으로 보고 싶었는데 tqdm 라이브러리의 존재를 몰라 비슷한 기능을 하는 코드를 직접 만들었습니다(...)
- 이 외에 다른 구체적인 사항은 코드를 구할 수 없어 명확히 기억나지는 않지만 기회가 되면 다시 작성해 보겠습니다.
